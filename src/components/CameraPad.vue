<template>
  <div class="flex items-center w-full h-full justify-center">
    <label
      for="dropzone"
      class="flex flex-col items-center justify-center w-full h-full cursor-pointer bg-gray-50 hover:bg-gray-100 dark:border-gray-600"
    >
      <div class="flex flex-col items-center justify-center pt-5 pb-6">
        <svg
          class="w-12 h-12 mb-3"
          viewBox="0 0 24 22"
        >
          <g>
            <path
              d="M 23.984375 14.5625 C 23.984375 14.5625 21.273438 7.527344 21.203125 7.367188 C 21.367188 6.960938 21.066406 5.546875 20.960938 5.429688 L 20.910156 4.542969 C 20.90625 4.472656 20.765625 4.421875 20.59375 4.433594 C 20.441406 4.441406 20.34375 4.433594 20.34375 4.433594 C 20.335938 4.359375 20.128906 4.289062 19.957031 4.3125 C 19.789062 4.335938 19.660156 4.410156 19.667969 4.480469 L 19.683594 4.816406 L 18.898438 2.890625 C 18.839844 2.726562 18.664062 2.644531 18.503906 2.703125 C 18.339844 2.761719 18.257812 2.941406 18.316406 3.105469 L 18.96875 5.082031 L 17.84375 3.566406 C 17.746094 3.425781 17.554688 3.390625 17.414062 3.488281 C 17.273438 3.585938 17.238281 3.78125 17.335938 3.921875 L 18.617188 5.902344 C 18.589844 5.980469 18.585938 6.128906 18.535156 6.179688 C 18.386719 6.324219 18.230469 6.496094 18.300781 6.769531 C 18.371094 7.042969 18.589844 7.21875 18.789062 7.167969 L 18.859375 7.148438 C 19.226562 7.554688 19.527344 7.980469 19.949219 8.082031 L 20.765625 12.742188 L 17.152344 11.542969 C 16.625 10.773438 15.84375 10.1875 14.886719 9.933594 C 14.074219 9.71875 13.253906 9.777344 12.515625 10.046875 C 12.464844 10.0625 5.292969 14.109375 5.292969 14.109375 L 2.421875 8.28125 C 2.488281 8.097656 2.535156 7.859375 2.550781 7.550781 C 2.570312 7.550781 2.589844 7.546875 2.609375 7.546875 C 3.121094 7.5 3.488281 7.371094 3.488281 6.765625 L 3.488281 2.042969 C 3.488281 1.371094 3.015625 0.601562 2.433594 0.324219 C 2.179688 0.203125 1.964844 0.273438 1.765625 0.292969 C 1.253906 0.335938 0.886719 0.464844 0.886719 1.070312 L 0.886719 3.554688 C 0.382812 3.75 0.394531 4.140625 0.0820312 5.429688 C -0.253906 6.808594 0.523438 8.167969 1.175781 8.558594 C 1.203125 8.832031 3.261719 16.582031 3.382812 16.792969 C 3.761719 17.457031 4.472656 17.757812 4.96875 17.472656 L 9.300781 15.390625 C 8.824219 17.257812 8.160156 19.847656 7.621094 21.96875 L 15.925781 21.96875 L 17.71875 15.074219 L 22.324219 16.175781 C 22.578125 16.261719 22.851562 16.210938 23.09375 16.058594 C 23.726562 15.800781 24.078125 14.984375 23.984375 14.5625 Z M 23.984375 14.5625 "
            />
            <path
              d="M 13.34375 8.511719 C 15.070312 9.253906 17.003906 8.796875 18.234375 7.515625 C 18.042969 7.378906 17.890625 7.160156 17.820312 6.894531 C 17.722656 6.519531 17.816406 6.152344 18.035156 5.921875 L 16.921875 4.199219 C 16.804688 4.023438 16.757812 3.808594 16.796875 3.597656 C 16.835938 3.386719 16.953125 3.199219 17.128906 3.078125 C 17.265625 2.984375 17.425781 2.933594 17.589844 2.933594 C 17.660156 2.933594 17.734375 2.945312 17.804688 2.960938 C 17.808594 2.855469 17.832031 2.753906 17.878906 2.652344 C 17.96875 2.457031 18.128906 2.308594 18.332031 2.234375 C 18.421875 2.199219 18.515625 2.183594 18.609375 2.183594 C 18.65625 2.183594 18.703125 2.191406 18.75 2.199219 C 18.753906 2.199219 18.757812 2.199219 18.761719 2.199219 C 18.804688 2.210938 18.847656 2.222656 18.890625 2.238281 C 18.433594 1.425781 17.722656 0.753906 16.804688 0.359375 C 14.570312 -0.605469 11.980469 0.441406 11.027344 2.691406 C 10.070312 4.945312 11.109375 7.550781 13.34375 8.511719 Z M 13.34375 8.511719 "
            />
          </g>
        </svg>
        <p class="mb-2 text-sm font-bold">Klik om een selfie te nemen!</p>
      </div>
      <input
        id="dropzone"
        ref="fileInput"
        type="file"
        accept="image/*"
        capture="user"
        class="hidden"
        @change="handlechange"
      >
    </label>
  </div>
</template>

<script setup lang="ts">
import { ref } from "vue";
import Resizer from "../utils/imageResizer";

const fileInput = ref<HTMLInputElement | null>(null);
const getInputString = async () => {
  if (!fileInput.value) {
    return "";
  }
  const input = fileInput.value;
  if (!input || !input.files) {
    return;
  }
  const uploadedFiles = input.files;
  if (uploadedFiles.length === 0) {
    return "";
  }
  const [imageFile] = uploadedFiles;
  const imageString = await new Promise<string>((resolve) => {
    Resizer.imageFileResizer(imageFile, 320, 240, "JPEG", 80, (uri) => {
      resolve(uri as string);
    });
  });
  return imageString;
};

const emit = defineEmits(["change"]);
const handlechange = () => {
  emit("change");
};

defineExpose({
  getInputString,
});
</script>
